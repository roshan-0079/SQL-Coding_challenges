CREATE DATABASE CAR_RENTAL_SYSTEM

CREATE TABLE VEHICLE(
CARID INT PRIMARY KEY,
MAKE VARCHAR(50),
MODEL VARCHAR(50),
YEAR INT,
DAILY_RATE INT,
STATUS INT,
PASSENGER_CAPACITY INT,
ENGINE_CAPACITY INT
)
CREATE TABLE CUSTOMER(
CUSTOMERID INT PRIMARY KEY,
FIRST_NAME VARCHAR(50),
LAST_NAME VARCHAR(50),
EMAIL VARCHAR(50),
PHONE_NUMBER VARCHAR(50)
)
CREATE TABLE LEASE(
LEASEID INT PRIMARY KEY,
CARID INT FOREIGN KEY(CARID) REFERENCES VEHICLE(CARID) ON DELETE CASCADE,
CUSTOMERID INT FOREIGN KEY(CUSTOMERID) REFERENCES CUSTOMER(CUSTOMERID) ON DELETE CASCADE,
START_DATE DATE,
END_DATE DATE,
LEASE_TYPE VARCHAR(50)
)
CREATE TABLE PAYMENT(
PAYMENTID INT PRIMARY KEY,
LEASEID INT FOREIGN KEY(LEASEID) REFERENCES LEASE(LEASEID) ON DELETE CASCADE,
PAYMENT_DATE DATE,
AMOUNT INT
)

INSERT INTO VEHICLE([CARID],[MAKE],[MODEL],[YEAR],[DAILY_RATE],[STATUS],[PASSENGER_CAPACITY],[ENGINE_CAPACITY])
VALUES(1,'TOYOTA','CAMRY',2022,50,1,4,1450)
INSERT INTO VEHICLE([CARID],[MAKE],[MODEL],[YEAR],[DAILY_RATE],[STATUS],[PASSENGER_CAPACITY],[ENGINE_CAPACITY])
VALUES(2,'HONDA','CIVIC',2023,45,1,7,1500)
INSERT INTO VEHICLE([CARID],[MAKE],[MODEL],[YEAR],[DAILY_RATE],[STATUS],[PASSENGER_CAPACITY],[ENGINE_CAPACITY])
VALUES(3,'FORD','FOCUS',2022,48,0,4,1400)
INSERT INTO VEHICLE([CARID],[MAKE],[MODEL],[YEAR],[DAILY_RATE],[STATUS],[PASSENGER_CAPACITY],[ENGINE_CAPACITY])
VALUES(4,'NISSAN','ALTIMA',2023,52,1,7,1200)
INSERT INTO VEHICLE([CARID],[MAKE],[MODEL],[YEAR],[DAILY_RATE],[STATUS],[PASSENGER_CAPACITY],[ENGINE_CAPACITY])
VALUES(5,'CHEVROLET','MALIBU',2022,47,1,4,1800)
INSERT INTO VEHICLE([CARID],[MAKE],[MODEL],[YEAR],[DAILY_RATE],[STATUS],[PASSENGER_CAPACITY],[ENGINE_CAPACITY])
VALUES(6,'HYUNDAI','SONATA',2023,49,0,7,1400)
INSERT INTO VEHICLE([CARID],[MAKE],[MODEL],[YEAR],[DAILY_RATE],[STATUS],[PASSENGER_CAPACITY],[ENGINE_CAPACITY])
VALUES(7,'BMW','3 SERIES',2023,60,1,7,2499)
INSERT INTO VEHICLE([CARID],[MAKE],[MODEL],[YEAR],[DAILY_RATE],[STATUS],[PASSENGER_CAPACITY],[ENGINE_CAPACITY])
VALUES(8,'MERCEDES','C-CLASS',2022,58,1,8,2599)
INSERT INTO VEHICLE([CARID],[MAKE],[MODEL],[YEAR],[DAILY_RATE],[STATUS],[PASSENGER_CAPACITY],[ENGINE_CAPACITY])
VALUES(9,'AUDI','A4',2022,55,0,4,2500)
INSERT INTO VEHICLE([CARID],[MAKE],[MODEL],[YEAR],[DAILY_RATE],[STATUS],[PASSENGER_CAPACITY],[ENGINE_CAPACITY])
VALUES(10,'LEXUS','ES',2023,54,1,4,2500)

INSERT INTO CUSTOMER([CUSTOMERID],[FIRST_NAME],[LAST_NAME],[EMAIL],[PHONE_NUMBER])
VALUES(1,'JOHN','DOE','johndoe@example.com','555-555-5555')
INSERT INTO CUSTOMER([CUSTOMERID],[FIRST_NAME],[LAST_NAME],[EMAIL],[PHONE_NUMBER])
VALUES(2,'JANE','SMITH','janesmith@example.com','555-123-4567')
INSERT INTO CUSTOMER([CUSTOMERID],[FIRST_NAME],[LAST_NAME],[EMAIL],[PHONE_NUMBER])
VALUES(3,'ROBERT','JOHNSON','robert@example.com','555-789-1234')
INSERT INTO CUSTOMER([CUSTOMERID],[FIRST_NAME],[LAST_NAME],[EMAIL],[PHONE_NUMBER])
VALUES(4,'SARAH','BROWN','sarah@example.com','555-456-7890')
INSERT INTO CUSTOMER([CUSTOMERID],[FIRST_NAME],[LAST_NAME],[EMAIL],[PHONE_NUMBER])
VALUES(5,'DAVID','LEE','david@example.com','555-987-6543')
INSERT INTO CUSTOMER([CUSTOMERID],[FIRST_NAME],[LAST_NAME],[EMAIL],[PHONE_NUMBER])
VALUES(6,'LAURA','HALL','laura@example.com','555-234-5678')
INSERT INTO CUSTOMER([CUSTOMERID],[FIRST_NAME],[LAST_NAME],[EMAIL],[PHONE_NUMBER])
VALUES(7,'MICHEAL','DAVIS','micheal@example.com','555-876-5432')
INSERT INTO CUSTOMER([CUSTOMERID],[FIRST_NAME],[LAST_NAME],[EMAIL],[PHONE_NUMBER])
VALUES(8,'EMMA','WILSON','emma@example.com','555-432-1098')
INSERT INTO CUSTOMER([CUSTOMERID],[FIRST_NAME],[LAST_NAME],[EMAIL],[PHONE_NUMBER])
VALUES(9,'WILLIAM','TAYLOR','william@example.com','555-321-6547')
INSERT INTO CUSTOMER([CUSTOMERID],[FIRST_NAME],[LAST_NAME],[EMAIL],[PHONE_NUMBER])
VALUES(10,'OLIVIA','ADAMS','olivia@example.com','555-765-4321')

INSERT INTO LEASE([LEASEID],[CARID],[CUSTOMERID],[START_DATE],[END_DATE],[LEASE_TYPE])
VALUES(1,1,1,'2023-01-01','2023-01-05','DAILY')
INSERT INTO LEASE([LEASEID],[CARID],[CUSTOMERID],[START_DATE],[END_DATE],[LEASE_TYPE])
VALUES(2,2,2,'2023-02-15','2023-02-28','MONTHLY')
INSERT INTO LEASE([LEASEID],[CARID],[CUSTOMERID],[START_DATE],[END_DATE],[LEASE_TYPE])
VALUES(3,3,3,'2023-03-10','2023-03-15','DAILY')
INSERT INTO LEASE([LEASEID],[CARID],[CUSTOMERID],[START_DATE],[END_DATE],[LEASE_TYPE])
VALUES(4,4,4,'2023-04-20','2023-04-30','MONTHLY')
INSERT INTO LEASE([LEASEID],[CARID],[CUSTOMERID],[START_DATE],[END_DATE],[LEASE_TYPE])
VALUES(5,5,5,'2023-05-05','2023-05-10','DAILY')
INSERT INTO LEASE([LEASEID],[CARID],[CUSTOMERID],[START_DATE],[END_DATE],[LEASE_TYPE])
VALUES(6,4,3,'2023-06-15','2023-06-30','MONTHLY')
INSERT INTO LEASE([LEASEID],[CARID],[CUSTOMERID],[START_DATE],[END_DATE],[LEASE_TYPE])
VALUES(7,7,7,'2023-07-01','2023-07-10','DAILY')
INSERT INTO LEASE([LEASEID],[CARID],[CUSTOMERID],[START_DATE],[END_DATE],[LEASE_TYPE])
VALUES(8,8,8,'2023-08-12','2023-08-15','MONTHLY')
INSERT INTO LEASE([LEASEID],[CARID],[CUSTOMERID],[START_DATE],[END_DATE],[LEASE_TYPE])
VALUES(9,3,3,'2023-09-07','2023-09-10','DAILY')
INSERT INTO LEASE([LEASEID],[CARID],[CUSTOMERID],[START_DATE],[END_DATE],[LEASE_TYPE])
VALUES(10,10,10,'2023-10-10','2023-10-31','MONTHLY')

INSERT INTO PAYMENT([PAYMENTID],[LEASEID],[PAYMENT_DATE],[AMOUNT])
VALUES(1,1,'2023-01-03',200)
INSERT INTO PAYMENT([PAYMENTID],[LEASEID],[PAYMENT_DATE],[AMOUNT])
VALUES(2,2,'2023-01-03',1000)
INSERT INTO PAYMENT([PAYMENTID],[LEASEID],[PAYMENT_DATE],[AMOUNT])
VALUES(3,3,'2023-01-03',75)
INSERT INTO PAYMENT([PAYMENTID],[LEASEID],[PAYMENT_DATE],[AMOUNT])
VALUES(4,4,'2023-01-03',900)
INSERT INTO PAYMENT([PAYMENTID],[LEASEID],[PAYMENT_DATE],[AMOUNT])
VALUES(5,5,'2023-01-03',60)
INSERT INTO PAYMENT([PAYMENTID],[LEASEID],[PAYMENT_DATE],[AMOUNT])
VALUES(6,6,'2023-01-03',1200)
INSERT INTO PAYMENT([PAYMENTID],[LEASEID],[PAYMENT_DATE],[AMOUNT])
VALUES(7,7,'2023-01-03',40)
INSERT INTO PAYMENT([PAYMENTID],[LEASEID],[PAYMENT_DATE],[AMOUNT])
VALUES(8,8,'2023-01-03',1100)
INSERT INTO PAYMENT([PAYMENTID],[LEASEID],[PAYMENT_DATE],[AMOUNT])
VALUES(9,9,'2023-01-03',80)
INSERT INTO PAYMENT([PAYMENTID],[LEASEID],[PAYMENT_DATE],[AMOUNT])
VALUES(10,10,'2023-01-03',1500)

--Q1
UPDATE VEHICLE 
SET DAILY_RATE = 68
WHERE MAKE='MERCEDES';
--Q2
DELETE FROM CUSTOMER
WHERE CUSTOMERID=2;
--Q3
EXEC sp_rename 'PAYMENT.PAYMENT_DATE', 'TRANSACTION_DATE', 'COLUMN';
--Q4 
SELECT * FROM CUSTOMER
WHERE EMAIL='sarah@example.com'
--Q5
SELECT *FROM Lease
WHERE NOT END_DATE<(CURRENT_TIMESTAMP);
--Q6
SELECT * FROM PAYMENT 
WHERE LEASEID IN (
SELECT LEASEID FROM LEASE 
WHERE CUSTOMERID IN (
SELECT CUSTOMERID FROM CUSTOMER 
WHERE PHONE_NUMBER = '555-555-5555'))
--Q7
SELECT AVG(DAILY_RATE) FROM VEHICLE WHERE STATUS=1 
--Q8
SELECT TOP 1 * FROM VEHICLE
ORDER BY DAILY_RATE DESC;
--Q9
select make,model from Vehicle 
where CARID in (
select l.CARID from Lease l
inner join Customer c
on c.customerID = l.customerID
where c.customerID=1
)
--Q10
SELECT TOP 1 * FROM LEASE
ORDER BY START_DATE DESC;
--Q11
SELECT * FROM PAYMENT
WHERE YEAR(PAYMENT_DATE) = 2023;
--Q12
SELECT * FROM CUSTOMER AS C
WHERE NOT EXISTS (
SELECT 1
FROM PAYMENT AS P
INNER JOIN LEASE AS L ON P.LEASEID = L.LEASEID
WHERE L.CUSTOMERID = C.CUSTOMERID
)
--Q13
SELECT V.CARID, COUNT(V.CARID) AS PAYMENT_COUNT,V.MAKE,V.MODEL,V.DAILY_RATE,V.PASSENGER_CAPACITY,V.ENGINE_CAPACITY 
FROM LEASE AS L
INNER JOIN VEHICLE AS V ON L.CARID = V.CARID
GROUP BY V.CARID,V.MAKE,V.MODEL,V.DAILY_RATE,V.PASSENGER_CAPACITY,V.ENGINE_CAPACITY
--Q14
SELECT C.CUSTOMERID,C.FIRST_NAME, C.LAST_NAME, SUM(AMOUNT) AS TOTAL_SPENT FROM CUSTOMER AS C
LEFT JOIN LEASE AS L ON C.CUSTOMERID=L.CUSTOMERID
LEFT JOIN PAYMENT AS P ON L.LEASEID = P.LEASEID
GROUP BY C.CUSTOMERID,FIRST_NAME,LAST_NAME,AMOUNT
ORDER BY C.CUSTOMERID 
--Q15
SELECT LEASEID, V.CARID,CUSTOMERID,MAKE,MODEL,DAILY_RATE,PASSENGER_CAPACITY,ENGINE_CAPACITY 
FROM VEHICLE AS V
RIGHT JOIN LEASE AS L ON L.CARID=V.CARID
--Q16
SELECT C.CUSTOMERID, FIRST_NAME,LAST_NAME,MAKE,MODEL,PASSENGER_CAPACITY,ENGINE_CAPACITY 
FROM LEASE AS L
INNER JOIN CUSTOMER AS C ON C.CUSTOMERID=L.CUSTOMERID
INNER JOIN VEHICLE AS V ON V.CARID=L.CARID
WHERE NOT END_DATE<(CURRENT_TIMESTAMP)
GROUP BY C.CUSTOMERID,C.FIRST_NAME,C.LAST_NAME,V.MAKE,V.MODEL,V.PASSENGER_CAPACITY,V.ENGINE_CAPACITY
--Q17
SELECT TOP 1 C.CUSTOMERID,C.FIRST_NAME, C.LAST_NAME, SUM(AMOUNT) AS TOTAL_SPENT FROM CUSTOMER AS C
INNER JOIN LEASE AS L ON C.CUSTOMERID=L.CUSTOMERID
INNER JOIN PAYMENT AS P ON L.LEASEID = P.LEASEID
GROUP BY C.CUSTOMERID,FIRST_NAME,LAST_NAME,AMOUNT
ORDER BY C.CUSTOMERID DESC
--Q18
SELECT V.CARID,V.MAKE,L.START_DATE,L.END_DATE,L.LEASE_TYPE FROM VEHICLE AS V
INNER JOIN LEASE AS L ON V.CARID = L.CARID
GROUP BY V.CARID,V.MAKE,L.START_DATE,L.END_DATE,L.LEASE_TYPE
